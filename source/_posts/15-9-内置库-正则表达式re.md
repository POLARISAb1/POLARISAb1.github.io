---
title: 15.9 内置库-正则表达式re
date: 2022-03-09 13:39:45
categories: 测试学习
tags: [python编程语言]

---

#  内置库re

## 1 正则表达式

### 1.1什么是正则表达式？

- 正则表达式就是记录文本规则的代码
- 可以查找操作符合某些复杂规则的字符串

### 1.2 使用场景

- 处理字符串
- 处理日志

### 1.3 在python中使用正则表达式

- 把正则表达式作为模式字符串
- 正则表达式可以使用原生字符串来表示
- 原生字符串需要在字符串前方加上`r`（`r'string'`）



## 2 使用re模块实现正则表达式操作

### 2.1 正则表达式对象转换

- `re.compile(pattern[, flags])`：用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 `match()` 和 `search()` 这两个函数使用。

    参数：

    - `pattern` : 一个字符串形式的正则表达式
    - `flags` : 可选，表示匹配模式，比如忽略大小写，多行模式等，具体参数为：
        1. `re.I` 忽略大小写
        2. `re.L` 表示特殊字符集 \w, \W, \b, \B, \s, \S 依赖于当前环境
        3. `re.M` 多行模式
        4. `re.S` 即为 `.` 并且包括换行符在内的任意字符（**.** 不包括换行符）
        5. `re.U` 表示特殊字符集 \w, \W, \b, \B, \d, \D, \s, \S 依赖于 Unicode 字符属性数据库
        6. `re.X` 为了增加可读性，忽略空格和 **#** 后面的注释

当匹配成功时返回一个 Match 对象，其中：

- `group([group1, …])` 方法用于获得一个或多个分组匹配的字符串，当要获得整个匹配的子串时，可直接使用 `group()` 或 `group(0)`
- `start([group])` 方法用于获取分组匹配的子串在整个字符串中的起始位置（子串第一个字符的索引），参数默认值为 0
- `end([group])` 方法用于获取分组匹配的子串在整个字符串中的结束位置（子串最后一个字符的索引+1），参数默认值为 0
- `span([group])` 方法返回 `(start(group), end(group))`

```

```

### 2.2 匹配字符串

#### 2.2.1 `match()`

`match(pattern, string, flags=0)`：从字符串的**开始处**进行匹配，如果不是起始位置匹配成功的话，`match()` 就返回 `None`。

参数说明：

| 参数    | 描述                                                         |
| :------ | :----------------------------------------------------------- |
| pattern | 匹配的正则表达式                                             |
| string  | 要匹配的字符串。                                             |
| flags   | 标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。（参见：正则表达式修饰符 - 可选标志） |

##### [1] 正则表达式修饰符 - 可选标志

正则表达式可以包含一些可选标志修饰符来控制匹配的模式。修饰符被指定为一个可选的标志。多个标志可以通过按位 `OR(|)` 它们来指定。如 `re.I | re.M` 被设置成 `I` 和 `M` 标志：

| 修饰符 | 描述                                                         |
| ------ | ------------------------------------------------------------ |
| re.I   | 使匹配对大小写不敏感                                         |
| re.L   | 做本地化识别（locale-aware）匹配                             |
| re.M   | 多行匹配，影响 ^ 和 $                                        |
| re.S   | 使 . 匹配包括换行在内的所有字符                              |
| re.U   | 根据Unicode字符集解析字符。这个标志影响 \w, \W, \b, \B.      |
| re.X   | 该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解。 |
| re.A   | 只进行ASCII匹配                                              |

##### [2] 正则表达式模式

模式字符串使用特殊的语法来表示一个正则表达式：

- 字母和数字表示他们自身。一个正则表达式模式中的字母和数字匹配同样的字符串。
- 多数字母和数字前加一个反斜杠时会拥有不同的含义。
- 标点符号只有被转义时才匹配自身，否则它们表示特殊的含义。
- 反斜杠本身需要使用反斜杠转义。
- 由于正则表达式通常都包含反斜杠，所以你最好使用原始字符串来表示它们。模式元素(如 `r'\t'`，等价于 `'\\t'`)匹配相应的特殊字符。

下表列出了正则表达式模式语法中的特殊元素。如果使用模式的同时提供了可选的标志参数，某些模式元素的含义会改变。

| 模式        | 描述                                                         |
| :---------- | :----------------------------------------------------------- |
| ^           | 匹配字符串的开头                                             |
| $           | 匹配字符串的末尾。                                           |
| .           | 匹配任意字符，除了换行符，当re.DOTALL标记被指定时，则可以匹配包括换行符的任意字符。 |
| [...]       | 用来表示一组字符,单独列出：[amk] 匹配 'a'，'m'或'k'          |
| [^...]      | 不在[]中的字符：[^abc] 匹配除了a,b,c之外的字符。             |
| re*         | 匹配0个或多个的表达式。                                      |
| re+         | 匹配1个或多个的表达式。                                      |
| re?         | 匹配0个或1个由前面的正则表达式定义的片段，非贪婪方式         |
| re{ n}      | 精确匹配 n 个前面表达式。例如， **o{2}** 不能匹配 "Bob" 中的 "o"，但是能匹配 "food" 中的两个 o。 |
| re{n,}      | 匹配 n 个前面表达式。例如， o{2,} 不能匹配"Bob"中的"o"，但能匹配 "foooood"中的所有 o。"o{1,}" 等价于 "o+"。"o{0,}" 则等价于 "o*"。 |
| re{n,m}     | 匹配 n 到 m 次由前面的正则表达式定义的片段，贪婪方式         |
| a\| b       | 匹配a或b                                                     |
| (re)        | 对正则表达式分组并记住匹配的文本                             |
| (?imx)      | 正则表达式包含三种可选标志：i, m, 或 x 。只影响括号中的区域。 |
| (?-imx)     | 正则表达式关闭 i, m, 或 x 可选标志。只影响括号中的区域。     |
| (?: re)     | 类似 (...), 但是不表示一个组                                 |
| (?imx:re)   | 在括号中使用i, m, 或 x 可选标志                              |
| (?-imx:re)  | 在括号中不使用i, m, 或 x 可选标志                            |
| (?#...)     | 注释.                                                        |
| (?= re)     | 前向肯定界定符。如果所含正则表达式，以 ... 表示，在当前位置成功匹配时成功，否则失败。但一旦所含表达式已经尝试，匹配引擎根本没有提高；模式的剩余部分还要尝试界定符的右边。 |
| (?! re)     | 前向否定界定符。与肯定界定符相反；当所含表达式不能在字符串当前位置匹配时成功 |
| (?> re)     | 匹配的独立模式，省去回溯。                                   |
| \w          | 匹配字母数字及下划线                                         |
| \W          | 匹配非字母数字及下划线                                       |
| \s          | 匹配任意空白字符，等价于 **[ \t\n\r\f]**。                   |
| \S          | 匹配任意非空字符                                             |
| \d          | 匹配任意数字，等价于 [0-9].                                  |
| \D          | 匹配任意非数字                                               |
| \A          | 匹配字符串开始                                               |
| \Z          | 匹配字符串结束，如果是存在换行，只匹配到换行前的结束字符串。 |
| \z          | 匹配字符串结束                                               |
| \G          | 匹配最后匹配完成的位置。                                     |
| \b          | 匹配一个单词边界，也就是指单词和空格间的位置。例如， 'er\b' 可以匹配"never" 中的 'er'，但不能匹配 "verb" 中的 'er'。 |
| \B          | 匹配非单词边界。'er\B' 能匹配 "verb" 中的 'er'，但不能匹配 "never" 中的 'er'。 |
| \n, \t, 等. | 匹配一个换行符。匹配一个制表符。等                           |
| \1...\9     | 匹配第n个分组的内容。                                        |
| \10         | 匹配第n个分组的内容，如果它经匹配。否则指的是八进制字符码的表达式。 |

> `+`匹配一个或多个，如`\d+`就是匹配一个或多个数字：0，11，234。

##### [3] 获取匹配表达式

可以使用 group(num) 或 groups() 匹配对象函数来获取匹配表达式。

| 匹配对象方法 | 描述                                                         |
| :----------- | :----------------------------------------------------------- |
| group(num=0) | 匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。 |
| groups()     | 返回一个包含所有小组字符串的元组，从 1 到 所含的小组号。     |

例子：

```python
import re

pattern = r'yyl'

s1 = 'yyldsiphdkd123jksnyylsfkd45f'
match1 = re.match(pattern, s1, re.I)
print(f'pattern与s1的匹配状况为：{match1}')
print(f'匹配值的起始位置为：{match1.start()}')
print(f'匹配值的结束位置为：{match1.end()}')
print(f'匹配位置的元组为：{match1.span()}')
print(f'要匹配的字符串为：{match1.string}')
print(f'匹配的数据为：{match1.group()}')


s2 = 'd3k4jfnklh<jCOPyyl'
match2 = re.match(pattern, s2,re.I)
print(f'pattern与s2的匹配状况为：{match2}')
```

结果：

```
pattern与s1的匹配状况为：<re.Match object; span=(0, 3), match='yyl'>
匹配值的起始位置为：0
匹配值的结束位置为：3
匹配位置的元组为：(0, 3)
要匹配的字符串为：yyldsiphdkd123jksnyylsfkd45f
匹配的数据为：yyl
pattern与s2的匹配状况为：None
```



#### 2.2.2 search()

`re.search(pattern, string, flags=0)`：在整个字符串中搜索第一个匹配的值，匹配成功`re.search`方法返回一个匹配的对象，否则返回`None`。

其余方法同`match()`

例子： 

```python
s3 = 'd3k4jfnklh<jCOPyyl'
match3 = re.search(pattern, s3,re.I)
print(f'pattern与s2的匹配状况为：{match3}')
print(f'匹配值的起始位置为：{match3.start()}')
print(f'匹配值的结束位置为：{match3.end()}')
print(f'匹配位置的元组为：{match3.span()}')
print(f'要匹配的字符串为：{match3.string}')
print(f'匹配的数据为：{match3.group()}')
```

结果：

```
pattern与s2的匹配状况为：<re.Match object; span=(15, 18), match='yyl'>
匹配值的起始位置为：15
匹配值的结束位置为：18
匹配位置的元组为：(15, 18)
要匹配的字符串为：d3k4jfnklh<jCOPyyl
匹配的数据为：yyl
```



#### 2.2.3 findall()

`findall(string[, pos[, endpos]])`：在整个字符串中搜索所有符合正则表达式的字符串，返回列表。

参数：

- string : 待匹配的字符串。
- pos : 可选参数，指定字符串的起始位置，默认为 0。
- endpos : 可选参数，指定字符串的结束位置，默认为字符串的长度

```python
# 匹配正则表达式:yyl
pattern = r'yyl'
s4 = 'd3k42jfyylnklh<jCOPyyl'
match4 = re.findall(pattern, s4)
print(f'pattern与s4的匹配结果为：{match4}')

# 匹配正则表达式:一个任意数字
pattern1 = r'\d'
match5 = re.findall(pattern1, s4)
print(f'pattern1与s4的匹配结果为：{match5}')

# 匹配正则表达式:一个或多个任意数字
pattern2 = r'\d+'
match6 = re.findall(pattern2, s4)
print(f'pattern2与s4的匹配结果为：{match6}')
```

结果：

```
pattern与s4的匹配结果为：['yyl', 'yyl']
pattern1与s4的匹配结果为：['3', '4', '2']
pattern2与s4的匹配结果为：['3', '42']
```



### 2.3 替换字符串`sub()`

`re.sub(pattern, repl, string, count=0, flags=0)`：实现字符串替换中的匹配项。

参数：

- pattern : 正则中的模式字符串。
- repl : 替换的字符串，也可为一个函数。
- string : 要被查找替换的原始字符串。
- count : 模式匹配后替换的最大次数，默认 0 表示替换所有的匹配。

```python
import re

phone = "2004-959-559 # 这是一个国外电话号码"

# 删除字符串中的 Python注释
num = re.sub(r'#.*$', "", phone)
print("电话号码是: ", num)

# 删除非数字(-)的字符串
num = re.sub(r'\D', "", phone)
print("电话号码是 : ", num)
```

结果：

```
电话号码是:  2004-959-559 
电话号码是 :  2004959559
```



### 2.4 分割字符串`split()`

`re.split(pattern, string[, maxsplit=0, flags=0])`：根据匹配的子串将字符串分割后返回列表

参数：

| 参数     | 描述                                                         |
| :------- | :----------------------------------------------------------- |
| pattern  | 匹配的正则表达式                                             |
| string   | 要匹配的字符串。                                             |
| maxsplit | 分隔次数，maxsplit=1 分隔一次，默认为 0，不限制次数。        |
| flags    | 标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。（参见：正则表达式修饰符 - 可选标志） |

```python
pattern = r'[?|&]'
url = 'https://space.bilibili.com/3063235/favlist?spm_id_from=333.1007.0.0'
r = re.split(pattern, url)
print(r)
```

结果：

```
['https://space.bilibili.com/3063235/favlist','spm_id_from=333.1007.0.0']
```

